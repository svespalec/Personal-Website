---
import { Icon } from 'astro-icon/components';
import type { Project } from '../types';
import { projects } from '../data/projects';

const PROJECTS_PER_PAGE = 4;
const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE);
---

<section id="projects-section" class="hidden py-12 sm:py-16 relative">
  <div class="absolute inset-0 grid grid-cols-[repeat(auto-fit,minmax(5rem,1fr))] gap-20 opacity-[0.15] blur-[1px] -z-10">
    <div class="bg-gradient-to-b from-purple-500/50 to-transparent h-60 rounded-lg"></div>
  </div>
  
  <div class="container mx-auto px-4">
    <div class="max-w-3xl">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 sm:gap-0 mb-6 sm:mb-10">
        <h2 class="text-3xl sm:text-4xl font-bold text-white/90 tracking-tight">
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-purple-600">Featured Projects</span>
        </h2>
        <div class="flex gap-2">
          <button id="prev-page" class="px-3 py-1.5 rounded-lg bg-white/5 text-white/60 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all border border-white/5 hover:border-white/10">
            <Icon name="mdi:chevron-left" class="w-5 h-5" />
          </button>
          <button id="next-page" class="px-3 py-1.5 rounded-lg bg-white/5 text-white/60 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all border border-white/5 hover:border-white/10">
            <Icon name="mdi:chevron-right" class="w-5 h-5" />
          </button>
        </div>
      </div>
      
      <div class="relative">
        <div class="projects-container">
          <div class="grid grid-cols-1 gap-4 sm:gap-6">
            {projects.map((project, index) => (
              <div 
                class="project-item opacity-0 transition-all duration-500 ease-out"
                data-index={index}
              >
                <div class="group bg-[#1A1A1C]/50 border border-white/[0.08] rounded-lg p-4 sm:p-6
                            hover:border-purple-500/30 hover:bg-[#1A1A1C]/60
                            transition-all duration-300">
                  <div class="flex items-start gap-4">
                    <div class="bg-purple-500/10 p-3 rounded-xl border border-purple-500/20 group-hover:border-purple-500/40 
                                transition-all duration-500 group-hover:shadow-[0_0_1.5rem_0_rgba(168,85,247,0.1)] shrink-0">
                      <Icon name="mdi:folder-outline" class="w-6 h-6 text-purple-400" />
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center justify-between flex-wrap gap-4">
                        <h3 class="text-base sm:text-lg font-medium text-white/90 group-hover:text-white transition-colors duration-300">{project.title}</h3>
                        <div class="flex gap-4 shrink-0">
                          <a href={project.github} target="_blank" rel="noopener noreferrer" 
                             class="text-white/60 hover:text-white/90 transition-colors duration-300 hover:scale-110 transform">
                            <Icon name="mdi:github" class="w-5 h-5" />
                          </a>
                          <a href={project.demo} target="_blank" rel="noopener noreferrer"
                             class="text-white/60 hover:text-white/90 transition-colors duration-300 hover:scale-110 transform">
                            <Icon name="mdi:external-link" class="w-5 h-5" />
                          </a>
                        </div>
                      </div>
                      <p class="text-sm text-white/70 mt-2 mb-4 group-hover:text-white/80 transition-colors duration-300">{project.description}</p>
                      <div class="flex flex-wrap gap-1.5">
                        {project.tags.map(tag => (
                          <span class="px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm rounded-lg bg-purple-500/10 text-purple-300
                                     border border-purple-500/20 hover:border-purple-500/40 
                                     transition-all duration-300 cursor-default inline-block">
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  let currentPage = 0;
  const projectsPerPage = 4;
  const totalProjects = document.querySelectorAll('.project-item').length;
  const totalPages = Math.ceil(totalProjects / projectsPerPage);
  
  const prevButton = document.getElementById('prev-page') as HTMLButtonElement;
  const nextButton = document.getElementById('next-page') as HTMLButtonElement;
  
  function updatePagination() {
    const start = currentPage * projectsPerPage;
    const end = start + projectsPerPage;
    
    document.querySelectorAll('.project-item').forEach((item, index) => {
      if (index >= start && index < end) {
        item.classList.remove('hidden');
        setTimeout(() => {
          item.classList.remove('opacity-0');
          item.classList.add('opacity-100');
        }, 50 * (index - start));
      } else {
        item.classList.add('hidden', 'opacity-0');
        item.classList.remove('opacity-100');
      }
    });
    
    if (prevButton) prevButton.disabled = currentPage === 0;
    if (nextButton) nextButton.disabled = currentPage >= totalPages - 1;
  }
  
  prevButton?.addEventListener('click', () => {
    if (currentPage > 0) {
      currentPage--;
      updatePagination();
    }
  });
  
  nextButton?.addEventListener('click', () => {
    if (currentPage < totalPages - 1) {
      currentPage++;
      updatePagination();
    }
  });
  
  // Initial pagination setup
  document.addEventListener('DOMContentLoaded', () => {
    updatePagination();
  });
</script>